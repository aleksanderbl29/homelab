name: Selfhost redeploy
on:
  workflow_dispatch:
  push:
    branches:
      - 'main'
    paths-ignore:
      - '.github/workflows/auto-issue.yml'
      - '.github/workflows/webhook-call.yml'
      - '.github/dependabot.yml'

jobs:
  GitPull:
    runs-on: self-hosted
    steps:
      - name: Update local git
        shell: sh
        run: |
          cd /home/aleksanderbang-larsen/homelab
          git pull
  PortainerDeploy:
    runs-on: self-hosted
    needs: GitPull
    steps:
      - name: Deploy Portainer
        shell: sh
        run: |
          cd
          cd /home/aleksanderbang-larsen/homelab/portainer-traefik
          docker-compose up -d --force-recreate